{
  "name": "Smart Distribution ERP workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Add-product",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        624,
        192
      ],
      "id": "65b3a6e2-09ad-47f2-ab54-3c8defe68bde",
      "name": "Add Product into inventry",
      "webhookId": "eec7ec8f-c576-4945-9541-f0e58cd7f2f4"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1882242538,
          "mode": "list",
          "cachedResultName": "Vendor_Products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1882242538"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Vendor_ID": "={{ $json.body.Vendor_ID }}",
            "Product_ID": "={{ $json.body.Product_ID }}",
            "Purchase_Price": "={{ $json.body.Cost_Price }}",
            "Last_Purchase_Date": "={{ new Date().toISOString().split('T')[0] }}"
          },
          "matchingColumns": [
            "Vendor_ID"
          ],
          "schema": [
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Purchase_Price",
              "displayName": "Purchase_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last_Purchase_Date",
              "displayName": "Last_Purchase_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        960,
        368
      ],
      "id": "f22e754b-ba81-419c-9385-b1135c4522ca",
      "name": "Add Vender Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Product_ID": "={{ $json.body.Product_ID }}",
            "Name": "={{ $json.body.Name }}",
            "Cost_Price": "={{ $json.body.Cost_Price }}",
            "Sale_Price": "={{ $json.body.Sale_Price }}",
            "Current_Stock_Qty": "={{ $json.body.Current_Stock_Qty }}",
            "Unit": "={{ $json.body.Unit }}",
            "Vendor_ID": "={{ $json.body.Vendor_ID }}",
            "Vendor_Name": "={{ $json.body.Vendor_Name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Vendor_Name",
              "displayName": "Vendor_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Cost_Price",
              "displayName": "Cost_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sale_Price",
              "displayName": "Sale_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Stock_Qty",
              "displayName": "Current_Stock_Qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Unit",
              "displayName": "Unit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_Name",
              "displayName": "Vendor_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "headers",
              "displayName": "headers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "params",
              "displayName": "params",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "webhookUrl",
              "displayName": "webhookUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "executionMode",
              "displayName": "executionMode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        992,
        -32
      ],
      "id": "52ee6299-d76c-4385-abeb-3d72ab3a0a07",
      "name": "Add Product Inventry",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "Add Inventry Workflow",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        432,
        32
      ],
      "id": "2a203b72-63f8-4609-a03d-dbe489fb9c84",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "return [{ json: { Purchase_ID: \"PUR-\" + (parseInt($input.last().json.Purchase_ID.split('-')[1]) + 1).toString().padStart(3, '0') } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1536,
        272
      ],
      "id": "ccff23bc-6f59-431e-ad88-5836d12ee612",
      "name": "Generate Purchase Id"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1312,
        80
      ],
      "id": "960d1744-ffad-44d2-90e4-1ec3e0477c2b",
      "name": "Merge1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2087335172,
          "mode": "list",
          "cachedResultName": "Purchases_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2087335172"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A:A"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1328,
        272
      ],
      "id": "71da2bf1-5429-4a63-823d-bf279c9c8733",
      "name": "Get Purchase Id",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2087335172,
          "mode": "list",
          "cachedResultName": "Purchases_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2087335172"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Vendor_ID": "={{ $json.body.Vendor_ID }}",
            "Product_ID": "={{ $json.body.Product_ID }}",
            "Qty": "={{ $json.body.Current_Stock_Qty }}",
            "Cost_Price": "={{ $json.body.Cost_Price }}",
            "Total_Cost": "={{ $json.body.Cost_Price *$json.body.Current_Stock_Qty }}",
            "Date": "={{ new Date().toISOString().split('T')[0] }}",
            "Purchase_ID": "={{ $json.Purchase_ID }}"
          },
          "matchingColumns": [
            "Vendor_ID"
          ],
          "schema": [
            {
              "id": "Purchase_ID",
              "displayName": "Purchase_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Qty",
              "displayName": "Qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cost_Price",
              "displayName": "Cost_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total_Cost",
              "displayName": "Total_Cost",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1552,
        80
      ],
      "id": "0e29a86e-67ca-4a39-bdd8-0dbe4217ba60",
      "name": "Add Purchase Log",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "add-staff",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1008,
        960
      ],
      "id": "8229bd68-2c32-483b-ae5e-cbaa733d6ed8",
      "name": "Add Employee",
      "webhookId": "2d09e1f9-f8f2-46d6-aeaf-124d89cfd247"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Staff_ID": "={{ $json.body.Staff_ID }}",
            "Name": "={{ $json.body.Name }}",
            "Mobile": "={{ $json.body.Mobile }}",
            "Role": "={{ $json.body.Role }}",
            "Assigned_Area_ID": "={{ $json.body.Assigned_Area_ID }}",
            "Assigned_Area_Name": "={{ $json.body.Assigned_Area_Name }}",
            "Base_Salary": "={{ $json.body.Base_Salary }}",
            "Username": "={{ $json.body.Username }}",
            "Password_Hash": "={{ $json.body.Password_Hash }}",
            "Account_Status": "={{ $json.body.Account_Status }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Staff_ID",
              "displayName": "Staff_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Role",
              "displayName": "Role",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Mobile",
              "displayName": "Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_ID",
              "displayName": "Assigned_Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_Name",
              "displayName": "Assigned_Area_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Base_Salary",
              "displayName": "Base_Salary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Username",
              "displayName": "Username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Password_Hash",
              "displayName": "Password_Hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Account_Status",
              "displayName": "Account_Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -752,
        960
      ],
      "id": "59e2220e-a80b-44a3-93bf-baf9156d624c",
      "name": "Append row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -304,
        -48
      ],
      "id": "5f0a262d-53c2-4c89-b3e3-804878b660fa",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 162868306,
          "mode": "list",
          "cachedResultName": "Monthly_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=162868306"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1056,
        -32
      ],
      "id": "5b62f755-c582-4efb-80a5-ad241d4bc158",
      "name": "Get Monthly Summary",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 394901725,
          "mode": "list",
          "cachedResultName": "Vendor_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=394901725"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1280,
        -32
      ],
      "id": "253a37b1-46d9-43f7-b017-54eab6333d82",
      "name": "Get Vender Summary",
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 679680278,
          "mode": "list",
          "cachedResultName": "Daily_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=679680278"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1504,
        -32
      ],
      "id": "15324a30-e65c-469f-95d7-46b152695d6f",
      "name": "Get Daily Summary",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 494009928,
          "mode": "list",
          "cachedResultName": "Staff_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=494009928"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -832,
        -32
      ],
      "id": "6a63eab9-2c13-4847-9f1c-9123e4323c6c",
      "name": "Get Staff Summary",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1709989654,
          "mode": "list",
          "cachedResultName": "Area_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1709989654"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1728,
        -32
      ],
      "id": "40b3b3cc-e054-4791-aaf3-9027a9553705",
      "name": "Get Area Summary",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "path": "Today-Order",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1968,
        144
      ],
      "id": "b7b56ee2-9065-4be7-b324-433f570910a5",
      "name": "Today Order request",
      "webhookId": "49a2bebe-58e6-414e-88ff-0d7a0bfcdba8"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1264,
        144
      ],
      "id": "b4f6a5a0-3cb1-4fb8-9642-a8d7add8a3a4",
      "name": "Respond order"
    },
    {
      "parameters": {
        "path": "dashboard",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1952,
        -32
      ],
      "id": "fda14e2a-c086-425d-bdd2-b2797775e769",
      "name": "Dashboard data",
      "webhookId": "6ee986f5-d830-4e91-bbcb-70989d027600"
    },
    {
      "parameters": {
        "path": "Today-Customer",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -976,
        144
      ],
      "id": "b7bff08d-d077-4c29-a401-90dc1db62c35",
      "name": "Today Customer Detail",
      "webhookId": "860ed8c2-d94b-4691-9df1-5eed25f798b3"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -768,
        144
      ],
      "id": "99690702-f999-44c6-854d-1aac52689d67",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get today's date in YYYY-MM-DD format\nconst today = $now.toISO().split('T')[0];\n\n// Get the data from Google Sheets node\nconst sheetData = $input.all();\n\n// Filter for today's data\nconst todayData = sheetData.filter(item => item.json.Date === today);\n\n// Format the orders data professionally\nconst formattedOrders = todayData.map(item => {\n  const order = item.json;\n  return {\n    orderId: order.Order_ID,\n    orderDate: order.Date,\n    shopId: order.Shop_ID,\n    staffId: order.Staff_ID,\n    totalAmount: Number(order.Total_Amount),\n    status: order.Status,\n    proofLink: order.Proof_Link?.replace(/\"/g, '') || null\n  };\n});\n\n// Calculate totals\nconst totalAmount = formattedOrders.reduce((sum, order) => sum + order.totalAmount, 0);\nconst uniqueShops = [...new Set(formattedOrders.map(order => order.shopId))].length;\nconst uniqueStaff = [...new Set(formattedOrders.map(order => order.staffId))].length;\n\n// Prepare professional response\nconst response = {\n  status: \"success\",\n  message: `Retrieved ${formattedOrders.length} orders for ${today}`,\n  summary: {\n    date: today,\n    totalOrders: formattedOrders.length,\n    totalRevenue: totalAmount,\n    uniqueShops: uniqueShops,\n    uniqueStaffMembers: uniqueStaff\n  },\n  orders: formattedOrders\n};\n\nreturn response;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        144
      ],
      "id": "af5a1700-4f22-4e65-8626-4c7ae9385505",
      "name": "Extract data"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\nconst oneWeekAgo = new Date(today);\noneWeekAgo.setDate(today.getDate() - 7);\nconst oneWeekAgoStr = oneWeekAgo.toISOString().split('T')[0];\n\nconst allShops = $input.all().map(item => item.json);\n\n// Get shops visited in last 7 days\nconst recentShops = allShops.filter(shop => \n  new Date(shop.Last_Visit_Date) >= new Date(oneWeekAgoStr)\n);\n\n// Get shops with outstanding balance\nconst shopsWithBalance = allShops.filter(shop => \n  Number(shop.Current_Balance) > 0\n);\n\nconst formatShop = (shop) => ({\n  shopId: shop.Shop_ID,\n  name: shop.Shop_Name,\n  owner: shop.Owner_Name,\n  contact: `+${shop.Owner_Mobile}`,\n  area: shop.Area_ID,\n  financials: {\n    limit: Number(shop.Credit_Limit),\n    balance: Number(shop.Current_Balance),\n    available: Number(shop.Credit_Limit) - Number(shop.Current_Balance)\n  },\n  lastVisit: shop.Last_Visit_Date,\n  requiresFollowUp: Number(shop.Current_Balance) > 0 && new Date(shop.Last_Visit_Date) < new Date(oneWeekAgoStr)\n});\n\nreturn {\n  reportPeriod: `${oneWeekAgoStr} to ${today.toISOString().split('T')[0]}`,\n  summary: {\n    totalShops: allShops.length,\n    recentlyVisited: recentShops.length,\n    withOutstanding: shopsWithBalance.length,\n    requiresFollowUp: allShops.filter(s => \n      Number(s.Current_Balance) > 0 && new Date(s.Last_Visit_Date) < new Date(oneWeekAgoStr)\n    ).length\n  },\n  recentActivity: recentShops.map(formatShop),\n  outstandingAccounts: shopsWithBalance.map(formatShop).sort((a, b) => b.financials.balance - a.financials.balance),\n  highValueAccounts: allShops\n    .filter(s => Number(s.Credit_Limit) >= 400000)\n    .map(formatShop)\n    .sort((a, b) => b.financials.limit - a.financials.limit)\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -544,
        144
      ],
      "id": "e6ef403e-990c-4272-98d6-4bed497bff71",
      "name": "Extract Previous 7 Days customer"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -336,
        144
      ],
      "id": "1436d0ce-2acd-4326-9fd0-c01f56121bad",
      "name": "Respond customer data"
    },
    {
      "parameters": {
        "path": "Purchase-data",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1984,
        320
      ],
      "id": "2eabce8d-387c-456d-9f36-cb4dd4fa68af",
      "name": "Purchase Request",
      "webhookId": "86c4c5b3-339c-4d34-a671-1b90383a79ea"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2087335172,
          "mode": "list",
          "cachedResultName": "Purchases_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2087335172"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1776,
        320
      ],
      "id": "ab73ab23-bc90-4091-a9af-e15ca096cbcc",
      "name": "Get row(s) in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1360,
        320
      ],
      "id": "cb942e92-8921-45f4-a92a-194fcf7f6881",
      "name": "Respond purchase"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 494009928,
          "mode": "list",
          "cachedResultName": "Staff_Summary",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=494009928"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -752,
        336
      ],
      "id": "acb7dd4b-dc95-4894-8f06-427d9b7eb4ad",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get staff data\nconst staffData = $input.all();\n\n// Format currency function\nconst formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 2\n  }).format(amount);\n};\n\n// Filter and analyze staff with more than 5 orders\nconst qualifiedStaff = staffData.filter(item => item.json.Order_Count > 5);\n\n// If no staff has >5 orders, return informative message\nif (qualifiedStaff.length === 0) {\n  return {\n    status: \"info\",\n    message: \"No staff members have more than 5 orders\",\n    criteria: \"Order_Count > 5\",\n    totalStaff: staffData.length,\n    highestOrderCount: Math.max(...staffData.map(item => item.json.Order_Count)),\n    suggestions: \"Consider lowering the threshold or check data completeness\"\n  };\n}\n\n// Process qualified staff with enhanced metrics\nconst processedStaff = qualifiedStaff.map(item => {\n  const staff = item.json;\n  const sales = Number(staff.Total_Sales);\n  const profit = Number(staff.Total_Profit);\n  const orders = Number(staff.Order_Count);\n  const avgProfit = Number(staff.Avg_Profit_Per_Order);\n  \n  // Calculate additional metrics\n  const profitMargin = (profit / sales) * 100;\n  const salesPerOrder = sales / orders;\n  \n  return {\n    staffId: staff.Staff_ID,\n    staffName: staff.Staff_Name,\n    metrics: {\n      orderCount: orders,\n      totalSales: sales,\n      formattedSales: formatCurrency(sales),\n      totalProfit: profit,\n      formattedProfit: formatCurrency(profit),\n      avgProfitPerOrder: avgProfit,\n      formattedAvgProfit: formatCurrency(avgProfit),\n      profitMargin: Math.round(profitMargin * 100) / 100,\n      salesPerOrder: Math.round(salesPerOrder),\n      formattedSalesPerOrder: formatCurrency(salesPerOrder)\n    },\n    performance: {\n      level: orders >= 10 ? 'Elite' : orders >= 7 ? 'High' : 'Medium',\n      score: Math.round((orders * 0.4 + (profit / 10000) * 0.6) * 100) / 100,\n      badge: orders > 10 ? 'ðŸ†' : orders > 7 ? 'â­' : 'ðŸ‘'\n    },\n    insights: {\n      exceedsThreshold: true,\n      thresholdExceededBy: orders - 5,\n      profitPerOrderRank: avgProfit > 10000 ? 'High' : avgProfit > 5000 ? 'Medium' : 'Low'\n    }\n  };\n});\n\n// Sort by order count (highest first)\nprocessedStaff.sort((a, b) => b.metrics.orderCount - a.metrics.orderCount);\n\n// Calculate summary statistics\nconst summary = {\n  totalQualifiedStaff: processedStaff.length,\n  totalOrdersFromQualified: processedStaff.reduce((sum, staff) => sum + staff.metrics.orderCount, 0),\n  totalSalesFromQualified: processedStaff.reduce((sum, staff) => sum + staff.metrics.totalSales, 0),\n  totalProfitFromQualified: processedStaff.reduce((sum, staff) => sum + staff.metrics.totalProfit, 0),\n  averageOrdersPerQualified: processedStaff.reduce((sum, staff) => sum + staff.metrics.orderCount, 0) / processedStaff.length,\n  averageProfitPerQualified: processedStaff.reduce((sum, staff) => sum + staff.metrics.totalProfit, 0) / processedStaff.length,\n  highestOrderCount: Math.max(...processedStaff.map(staff => staff.metrics.orderCount)),\n  highestProfit: Math.max(...processedStaff.map(staff => staff.metrics.totalProfit))\n};\n\n// Format summary values\nsummary.formattedTotalSales = formatCurrency(summary.totalSalesFromQualified);\nsummary.formattedTotalProfit = formatCurrency(summary.totalProfitFromQualified);\nsummary.formattedAverageProfit = formatCurrency(summary.averageProfitPerQualified);\n\n// Return comprehensive response\nreturn {\n  status: \"success\",\n  filterApplied: \"Order_Count > 5\",\n  totalStaffAnalyzed: staffData.length,\n  qualifiedStaffCount: processedStaff.length,\n  summary: summary,\n  qualifiedStaff: processedStaff,\n  thresholds: {\n    elite: processedStaff.filter(s => s.performance.level === 'Elite').length,\n    high: processedStaff.filter(s => s.performance.level === 'High').length,\n    medium: processedStaff.filter(s => s.performance.level === 'Medium').length\n  },\n  timestamp: new Date().toISOString()\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -528,
        336
      ],
      "id": "ebf0908a-a477-44d7-9138-2e91ad08d582",
      "name": "filter staff with more than 5 order"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -320,
        336
      ],
      "id": "a9fe5c05-01d1-4c1e-a39e-f9cf922c2bb8",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "path": "Sales-data",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -960,
        336
      ],
      "id": "f39ff9db-fa43-4b58-9d28-17e0bb80c8b6",
      "name": "Get Sales Data",
      "webhookId": "a527cece-f23f-42f1-a77f-a9a1b7db5506"
    },
    {
      "parameters": {
        "jsCode": "let items = $input.all();\nlet nextId = items.length === 0 ? \"P001\" : \"P\" + (parseInt(items[items.length - 1].json.Product_ID.slice(1)) + 1).toString().padStart(3, '0');\nreturn [{ json: { newProductId: nextId } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1584,
        528
      ],
      "id": "02d0f58c-c7e0-4224-a7df-cf5253146f0c",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "path": "Product-id",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1984,
        528
      ],
      "id": "730e362f-18ec-4a92-b611-9814d971cb63",
      "name": "Get Product Id",
      "webhookId": "0b304e96-26d3-4488-87dc-a652405ea456"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A:A"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1792,
        528
      ],
      "id": "68f0a773-c716-4264-8d88-d8141ad26c37",
      "name": "Get Product ID",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1376,
        528
      ],
      "id": "c03e1697-c668-4927-9eaa-9b36e800fd36",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "path": "sales-id-order",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -960,
        528
      ],
      "id": "c2333e1e-f3d2-4028-b6b6-885b01d6744b",
      "name": "Get Sales Man Data By Id",
      "webhookId": "837ffca2-22a3-477c-816e-9d157c62fe0f"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1089928815,
          "mode": "list",
          "cachedResultName": "Sales_Orders_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1089928815"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Staff_ID",
              "lookupValue": "={{ $json.query.staffId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -752,
        528
      ],
      "id": "7bf8dd25-971d-40dc-b88d-9d449be961f9",
      "name": "Get row(s) in sheet4",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Convert incoming rows\nconst rows = items.map(i => i.json);\n\n// Get current month\nconst now = new Date();\nconst firstDay = new Date(now.getFullYear(), now.getMonth(), 1);\nconst lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n\n// Filter\nconst monthly = rows.filter(r => {\n  const d = new Date(r.Date);\n  return d >= firstDay && d <= lastDay;\n});\n\n// Clean formatting\nconst cleaned = monthly.map(r => ({\n  OrderID: r.Order_ID,\n  Date: r.Date,\n  ShopID: r.Shop_ID,\n  StaffID: r.Staff_ID,\n  TotalAmount: r.Total_Amount,\n  Status: r.Status,\n  ProofLink: r.Proof_Link?.replace(/\"/g, \"\") || null\n}));\n\n// RETURN AS VALID JSON BODY\nreturn [\n  {\n    json: {\n      success: true,\n      count: cleaned.length,\n      data: cleaned              // <--- Array properly placed under json\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -528,
        528
      ],
      "id": "c5d367d3-1856-447c-a506-3601a608cd23",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -304,
        528
      ],
      "id": "db179f93-62eb-4c1a-8b11-e743ed941b49",
      "name": "Respond with staff Id sales data"
    },
    {
      "parameters": {
        "path": "Order-Details",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2000,
        768
      ],
      "id": "1414d8d6-5f7a-4c25-aaa5-e2091067e43e",
      "name": "Order-details By id",
      "webhookId": "63780085-a30b-4e0a-8280-f40576600a68"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 145130453,
          "mode": "list",
          "cachedResultName": "Order-detail-rider",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=145130453"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Order_ID",
              "lookupValue": "={{ $json.query.orderId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1760,
        768
      ],
      "id": "223705b6-a895-4502-ae87-2d2f08b5fda8",
      "name": "Get row(s) in sheet5",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all items from Google Sheets\nconst inputItems = $input.all();\n\nconsole.log(\"Number of items received:\", inputItems.length);\n\n// If multiple items, combine them\nlet sheetData = [];\n\nif (inputItems.length === 1 && Array.isArray(inputItems[0].json)) {\n  // Single item that's already an array\n  sheetData = inputItems[0].json;\n  console.log(\"Single array item with\", sheetData.length, \"elements\");\n} else {\n  // Multiple items, each is one row\n  sheetData = inputItems.map(item => item.json);\n  console.log(\"Multiple items, total:\", sheetData.length);\n}\n\nconsole.log(\"All data:\", JSON.stringify(sheetData, null, 2));\n\n// Check if we have valid data\nif (!sheetData || sheetData.length === 0) {\n  return [{ \n    json: { \n      error: \"No order data found\",\n      order: null,\n      products: []\n    } \n  }];\n}\n\n// Create response object\nconst response = {\n  order: {\n    order_id: sheetData[0]?.Order_ID || sheetData[0]?.order_id,\n    shop_id: sheetData[0]?.Shop_ID || sheetData[0]?.shop_id,\n    date: sheetData[0]?.Date || sheetData[0]?.date,\n    total_amount: sheetData[0]?.Total_Amount || sheetData[0]?.total_amount,\n    status: sheetData[0]?.Status || sheetData[0]?.status\n  },\n  products: sheetData.map(item => ({\n    product_id: item.Product_ID || item.product_id,\n    product_name: item.Product_Name || item.product_name,\n    quantity: item.Quantity || item.quantity,\n    row_number: item.row_number\n  }))\n};\n\nconsole.log(\"Response products count:\", response.products.length);\n\nreturn [{ json: response }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1552,
        768
      ],
      "id": "4dbad958-ea34-452f-a7e5-0dfef1c03c78",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1344,
        768
      ],
      "id": "46d1c4de-89c2-4794-91ff-b548d3a676b6",
      "name": "Respond Order detail"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2052506336,
          "mode": "list",
          "cachedResultName": "Dilivery-History",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2052506336"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Rider-Id",
              "lookupValue": "={{ $json.query.riderId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -752,
        784
      ],
      "id": "e64ec3bc-ed60-4ac3-9e19-6792382b7d41",
      "name": "Get row(s) in sheet6",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -272,
        784
      ],
      "id": "6ef68284-4ec2-4173-b7ce-81b60e5a5a40",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "jsCode": "// Transform rider history with proper date-time formatting\nconst data = $input.all();\n\n// Extract array from input\nlet sheetData = [];\nif (data.length === 1 && Array.isArray(data[0].json)) {\n  sheetData = data[0].json;\n} else {\n  sheetData = data.map(item => item.json);\n}\n\n// Calculate date 7 days ago\nconst sevenDaysAgo = new Date();\nsevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\nsevenDaysAgo.setHours(0, 0, 0, 0);\n\n// Transform and filter\nconst deliveries = sheetData\n  .map((item) => {\n    // Parse date and time\n    const dateStr = item.Date;\n    const timeStr = item.Time || \"00:00\";\n    \n    let timestamp, displayTime;\n    \n    try {\n      // Convert time to 24-hour format if needed\n      let time24 = timeStr;\n      const timeLower = timeStr.toLowerCase().trim();\n      \n      if (timeLower.includes('am') || timeLower.includes('pm')) {\n        // Parse 12-hour format\n        const match = timeLower.match(/(\\d+):(\\d+)\\s*(am|pm)/);\n        if (match) {\n          let hours = parseInt(match[1]);\n          const minutes = match[2];\n          const period = match[3];\n          \n          if (period === 'pm' && hours < 12) hours += 12;\n          if (period === 'am' && hours === 12) hours = 0;\n          \n          time24 = `${hours.toString().padStart(2, '0')}:${minutes}`;\n        }\n      }\n      \n      // Create Date object\n      timestamp = new Date(`${dateStr}T${time24}:00`);\n      \n      // Format for display: \"10 Dec, 12:17 AM\"\n      const formattedDate = timestamp.toLocaleDateString('en-IN', {\n        day: '2-digit',\n        month: 'short'\n      });\n      \n      const formattedTime = timestamp.toLocaleTimeString('en-IN', {\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n      });\n      \n      displayTime = `${formattedDate}, ${formattedTime}`;\n      \n    } catch (e) {\n      console.error(\"Error parsing date:\", e);\n      timestamp = new Date();\n      displayTime = \"Date format error\";\n    }\n    \n    return {\n      id: item.row_number,\n      order_id: item[\"Order-Id\"],\n      shop_id: item[\"Shop_Id\"],\n      cash_received: parseFloat(item[\"Cash-Recieved\"] || 0),\n      status: item[\"Order_status\"],\n      timestamp: timestamp.toISOString(),\n      display_time: displayTime, // This is what you need\n      rider_id: item[\"Rider-Id\"],\n      rider_name: item[\"Rider_Name\"],\n      return_items: []\n    };\n  })\n  // Filter last 7 days\n  .filter(delivery => {\n    const deliveryDate = new Date(delivery.timestamp);\n    return deliveryDate >= sevenDaysAgo;\n  })\n  // Sort newest first\n  .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n\nconsole.log(\"Processed deliveries:\", deliveries.length);\ndeliveries.forEach(d => {\n  console.log(`Order: ${d.order_id}, Time: ${d.display_time}`);\n});\n\nreturn [{\n  json: {\n    deliveries: deliveries,\n    count: deliveries.length,\n    filter_applied: \"last_7_days\"\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -528,
        784
      ],
      "id": "c8e43d21-b146-474b-aeb2-deb062e44775",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "path": "all-delivery",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2016,
        992
      ],
      "id": "d39a6ba9-f4cb-4cd2-bfee-03cfe6c1543f",
      "name": "Get All Delivery for admin",
      "webhookId": "7c2980c2-0f5a-4773-b5d9-fe9247be5954"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2052506336,
          "mode": "list",
          "cachedResultName": "Dilivery-History",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2052506336"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1808,
        992
      ],
      "id": "46bd771f-5f22-4dde-b341-fcfef7b6ee09",
      "name": "Get All Delivery",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Transform Google Sheets data for Admin Delivery Dashboard\nconst input = $input.all();\n\n// Extract the data array\nlet sheetData = [];\nif (input.length === 1 && Array.isArray(input[0].json)) {\n  sheetData = input[0].json;\n} else {\n  sheetData = input.map(item => item.json);\n}\n\nconsole.log(\"Processing\", sheetData.length, \"deliveries from Google Sheets\");\n\n// Transform data\nconst deliveries = sheetData.map((item, index) => {\n  // Parse date and time\n  const dateStr = item.Date;\n  const timeStr = item.Time || \"00:00\";\n  \n  let timestamp;\n  let displayTime;\n  \n  try {\n    // Convert time to 24-hour format if it's in 12-hour format\n    let time24 = timeStr;\n    const timeLower = timeStr.toLowerCase().trim();\n    \n    if (timeLower.includes('am') || timeLower.includes('pm')) {\n      // Parse 12-hour format like \"11:10 AM\" or \"12:10 AM\"\n      const match = timeLower.match(/(\\d+):(\\d+)\\s*(am|pm)/);\n      if (match) {\n        let hours = parseInt(match[1]);\n        const minutes = match[2];\n        const period = match[3];\n        \n        // Handle 12 AM and 12 PM correctly\n        if (period === 'pm' && hours < 12) {\n          hours += 12;\n        } else if (period === 'am' && hours === 12) {\n          hours = 0;\n        }\n        \n        time24 = `${hours.toString().padStart(2, '0')}:${minutes}`;\n      }\n    }\n    \n    // Create timestamp by combining date and time\n    timestamp = new Date(`${dateStr}T${time24}:00`);\n    \n    // Format for display: \"09 Dec, 11:10 AM\"\n    const formattedDate = timestamp.toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: 'short'\n    });\n    \n    const formattedTime = timestamp.toLocaleTimeString('en-IN', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: true\n    });\n    \n    displayTime = `${formattedDate}, ${formattedTime}`;\n    \n  } catch (error) {\n    console.error(\"Error parsing date/time:\", error, \"for item:\", item);\n    timestamp = new Date();\n    displayTime = `${dateStr}, ${timeStr}`;\n  }\n  \n  // Parse return items if available\n  let returnItems = [];\n  if (item[\"Return_Items\"] || item[\"return_items\"] || item[\"Return_Details\"]) {\n    try {\n      const returnItemsStr = item[\"Return_Items\"] || item[\"return_items\"] || item[\"Return_Details\"];\n      if (typeof returnItemsStr === 'string' && returnItemsStr.trim()) {\n        returnItems = JSON.parse(returnItemsStr);\n      } else if (Array.isArray(returnItemsStr)) {\n        returnItems = returnItemsStr;\n      }\n    } catch (parseError) {\n      console.error(\"Error parsing return items:\", parseError);\n      returnItems = [];\n    }\n  }\n  \n  return {\n    id: item.row_number || index + 1,\n    order_id: item[\"Order-Id\"] || item.order_id,\n    shop_id: item[\"Shop_Id\"] || item.shop_id,\n    cash_received: parseFloat(item[\"Cash-Recieved\"] || item.cash_received || 0),\n    status: item[\"Order_status\"] || item.status,\n    timestamp: timestamp.toISOString(),\n    display_time: displayTime,\n    rider_id: item[\"Rider-Id\"] || item.rider_id,\n    rider_name: item[\"Rider_Name\"] || item.rider_name,\n    return_items: returnItems\n  };\n});\n\n// Calculate statistics\nconst total = deliveries.length;\nconst delivered = deliveries.filter(d => d.status === \"Delivered\").length;\nconst partialReturn = deliveries.filter(d => d.status === \"Partial Return\").length;\nconst fullyReturned = deliveries.filter(d => d.status === \"Fully Returned\").length;\nconst failed = deliveries.filter(d => d.status === \"Failed\").length;\nconst totalCash = deliveries.reduce((sum, d) => sum + (d.cash_received || 0), 0);\nconst returnsCount = deliveries.reduce((sum, d) => sum + (d.return_items?.length || 0), 0);\n\nconsole.log(\"Statistics:\", {\n  total,\n  delivered,\n  partialReturn,\n  fullyReturned,\n  failed,\n  totalCash,\n  returnsCount\n});\n\n// Return data in expected format\nreturn [{\n  json: {\n    deliveries: deliveries,\n    stats: {\n      total,\n      delivered,\n      partialReturn,\n      fullyReturned,\n      failed,\n      totalCash,\n      returnsCount\n    },\n    count: deliveries.length,\n    last_updated: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1600,
        992
      ],
      "id": "3361bc04-e697-4cf1-8863-c5343832d1a9",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1392,
        992
      ],
      "id": "f19af480-137a-4112-93d9-c6be3a344029",
      "name": "Respond to dilivery for admin"
    },
    {
      "parameters": {
        "path": "Dilivery-History",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -992,
        784
      ],
      "id": "7ea743f6-08bd-4d29-a832-00cd050525ed",
      "name": "Get Delivery History",
      "webhookId": "2823df60-3e68-4453-97ca-2f1d33ba0c12"
    },
    {
      "parameters": {
        "jsCode": "// Get data from all previous nodes\nconst areaData = $('Get Area Summary').all().map(item => item.json);\nconst dailyData = $('Get Daily Summary').first().json;\nconst vendorData = $('Get Vender Summary').all().map(item => item.json);\nconst monthlyData = $('Get Monthly Summary').first().json;\nconst staffDataRaw = $('Get Staff Summary').all().map(item => item.json);\n\n// Filter out invalid data\nconst validAreaData = areaData.filter(area => area && area.Area && area.Area !== \"#N/A\");\nconst validVendorData = vendorData.filter(vendor => vendor && vendor.Vendor_ID && vendor.Vendor_ID !== \"#N/A\");\nconst validStaffData = staffDataRaw.filter(staff => staff && staff.Staff_ID && staff.Staff_ID !== \"#N/A\");\n\n// Helper function to parse numbers safely\nconst safeNumber = (value, defaultValue = 0) => {\n  if (value === null || value === undefined || value === \"#N/A\" || value === \"\") return defaultValue;\n  const num = Number(value);\n  return isNaN(num) ? defaultValue : num;\n};\n\n// Debug: Check raw area data\nconsole.log(\"=== AREA DATA DEBUG ===\");\nvalidAreaData.forEach((area, i) => {\n  console.log(`Area ${i}:`, area.Area, \"Sales:\", area.Area_Sales, \"Profit:\", area.Area_Profit);\n});\n\n// Find top performing area (by sales) - CRITICAL FIX HERE\nlet topAreaBySales = { Area: \"No data\", Area_Sales: 0, Area_Profit: 0, Orders: 0 };\nif (validAreaData.length > 0) {\n  topAreaBySales = validAreaData.reduce((maxArea, currentArea) => {\n    const currentSales = safeNumber(currentArea.Area_Sales);\n    const maxSales = safeNumber(maxArea.Area_Sales);\n    console.log(`Comparing: ${currentArea.Area} (${currentSales}) vs ${maxArea.Area} (${maxSales})`);\n    return currentSales > maxSales ? currentArea : maxArea;\n  }, validAreaData[0]);\n}\n\n// Find top performing vendor (by profit)\nlet topVendorByProfit = { Vendor_ID: \"No data\", Vendor_Sales: 0, Vendor_Profit: 0, Vendor_Profit_Margin: 0 };\nif (validVendorData.length > 0) {\n  topVendorByProfit = validVendorData.reduce((maxVendor, currentVendor) => {\n    const currentProfit = safeNumber(currentVendor.Vendor_Profit);\n    const maxProfit = safeNumber(maxVendor.Vendor_Profit);\n    return currentProfit > maxProfit ? currentVendor : maxVendor;\n  }, validVendorData[0]);\n}\n\n// Find top performing staff (by sales)\nlet topStaffBySales = { Staff_Name: \"No data\", Total_Sales: 0, Total_Profit: 0, Order_Count: 0 };\nif (validStaffData.length > 0) {\n  topStaffBySales = validStaffData.reduce((maxStaff, currentStaff) => {\n    const currentSales = safeNumber(currentStaff.Total_Sales);\n    const maxSales = safeNumber(maxStaff.Total_Sales);\n    return currentSales > maxSales ? currentStaff : maxStaff;\n  }, validStaffData[0]);\n}\n\n// Find top performing staff (by profit)\nlet topStaffByProfit = { Staff_Name: \"No data\", Total_Profit: 0, Total_Sales: 0, Avg_Profit_Per_Order: 0 };\nif (validStaffData.length > 0) {\n  topStaffByProfit = validStaffData.reduce((maxStaff, currentStaff) => {\n    const currentProfit = safeNumber(currentStaff.Total_Profit);\n    const maxProfit = safeNumber(maxStaff.Total_Profit);\n    return currentProfit > maxProfit ? currentStaff : maxStaff;\n  }, validStaffData[0]);\n}\n\nconsole.log(\"=== TOP AREA RESULT ===\");\nconsole.log(\"Selected Area:\", topAreaBySales.Area);\nconsole.log(\"Area Sales:\", topAreaBySales.Area_Sales);\nconsole.log(\"Area Profit:\", topAreaBySales.Area_Profit);\n\n// Format top performers data\nconst formattedTopArea = {\n  area: topAreaBySales.Area || \"No data\",\n  sales: safeNumber(topAreaBySales.Area_Sales),\n  profit: safeNumber(topAreaBySales.Area_Profit),\n  orders: safeNumber(topAreaBySales.Orders)\n};\n\nconst formattedTopVendor = {\n  vendor_id: topVendorByProfit.Vendor_ID || \"No data\",\n  sales: safeNumber(topVendorByProfit.Vendor_Sales),\n  profit: safeNumber(topVendorByProfit.Vendor_Profit),\n  profit_margin: safeNumber(topVendorByProfit.Vendor_Profit_Margin)\n};\n\nconst formattedTopStaffSales = {\n  staff_name: topStaffBySales.Staff_Name || \"No data\",\n  total_sales: safeNumber(topStaffBySales.Total_Sales),\n  total_profit: safeNumber(topStaffBySales.Total_Profit),\n  order_count: safeNumber(topStaffBySales.Order_Count)\n};\n\nconst formattedTopStaffProfit = {\n  staff_name: topStaffByProfit.Staff_Name || \"No data\",\n  total_profit: safeNumber(topStaffByProfit.Total_Profit),\n  total_sales: safeNumber(topStaffByProfit.Total_Sales),\n  avg_profit_per_order: safeNumber(topStaffByProfit.Avg_Profit_Per_Order)\n};\n\n// Create combined output object for dashboard\nconst combinedData = {\n  summary_date: new Date().toISOString(),\n  summary_period: dailyData.Date || null,\n  \n  daily_summary: {\n    date: dailyData.Date || null,\n    total_sale: safeNumber(dailyData.Total_Sale),\n    total_profits: safeNumber(dailyData.Total_Profits),\n    orders_count: safeNumber(dailyData.Orders_Count)\n  },\n  \n  monthly_summary: {\n    month: monthlyData.Month || null,\n    total_orders: safeNumber(monthlyData.Total_Orders),\n    monthly_sales: safeNumber(monthlyData.Monthly_Sales),\n    monthly_profit: safeNumber(monthlyData.Monthly_Profit),\n    monthly_profit_margin: safeNumber(monthlyData.Monthly_Profit_Margin)\n  },\n  \n  top_performers: {\n    top_area_sales: formattedTopArea,\n    top_vendor_profit: formattedTopVendor,\n    top_staff_sales: formattedTopStaffSales,\n    top_staff_profit: formattedTopStaffProfit\n  },\n  \n  summary_counts: {\n    total_customers: 0,\n    total_orders: safeNumber(monthlyData.Total_Orders),\n    total_products: 0,\n    total_areas: validAreaData.length,\n    total_vendors: validVendorData.length,\n    total_staff: validStaffData.length\n  },\n  \n  key_metrics: {\n    daily_profit_margin: safeNumber(dailyData.Total_Sale) > 0 ? (safeNumber(dailyData.Total_Profits) / safeNumber(dailyData.Total_Sale)) : 0,\n    monthly_growth: 0,\n    average_order_value: safeNumber(monthlyData.Total_Orders) > 0 ? (safeNumber(monthlyData.Monthly_Sales) / safeNumber(monthlyData.Total_Orders)) : 0\n  }\n};\n\n// Return the combined data\nreturn combinedData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -544,
        -48
      ],
      "id": "bfe659b6-b28d-493c-9f3e-85868561ced7",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1089928815,
          "mode": "list",
          "cachedResultName": "Sales_Orders_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1089928815"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Date",
              "lookupValue": "={{$now.toISO().split('T')[0]}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1728,
        144
      ],
      "id": "f075c461-b40f-4e7f-a363-82860c95ce0e",
      "name": "Get row(s) in sheet7",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date().toISOString().split('T')[0];\nconst oneMonthAgo = new Date();\noneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\nconst oneMonthAgoStr = oneMonthAgo.toISOString().split('T')[0];\n\nconst purchases = $input.all().map(item => ({\n  purchaseId: item.json.Purchase_ID,\n  vendor: item.json.Vendor_ID,\n  product: item.json.Product_ID,\n  quantity: Number(item.json.Qty),\n  unitCost: Number(item.json.Cost_Price),\n  totalCost: Number(item.json.Total_Cost),\n  date: item.json.Date,\n  isRecent: item.json.Date >= oneMonthAgoStr\n}));\n\n// Group by product for inventory analysis\nconst productStats = purchases.reduce((acc, p) => {\n  if (!acc[p.product]) {\n    acc[p.product] = {\n      productId: p.product,\n      totalQuantity: 0,\n      totalCost: 0,\n      purchaseCount: 0,\n      vendors: new Set(),\n      averageUnitCost: 0,\n      lastPurchaseDate: p.date\n    };\n  }\n  \n  acc[p.product].totalQuantity += p.quantity;\n  acc[p.product].totalCost += p.totalCost;\n  acc[p.product].purchaseCount++;\n  acc[p.product].vendors.add(p.vendor);\n  \n  // Update last purchase date if newer\n  if (new Date(p.date) > new Date(acc[p.product].lastPurchaseDate)) {\n    acc[p.product].lastPurchaseDate = p.date;\n  }\n  \n  return acc;\n}, {});\n\n// Calculate averages and clean up\nObject.values(productStats).forEach(product => {\n  product.averageUnitCost = product.totalCost / product.totalQuantity;\n  product.vendorCount = product.vendors.size;\n  product.daysSinceLastPurchase = Math.floor(\n    (new Date(today) - new Date(product.lastPurchaseDate)) / (1000 * 60 * 60 * 24)\n  );\n  product.reorderPriority = product.daysSinceLastPurchase > 30 ? 'High' : \n                           product.daysSinceLastPurchase > 15 ? 'Medium' : 'Low';\n  delete product.vendors;\n});\n\n// Sort products by total quantity purchased\nconst sortedProducts = Object.values(productStats).sort((a, b) => b.totalQuantity - a.totalQuantity);\n\nreturn {\n  analysisDate: today,\n  analysisPeriod: `${oneMonthAgoStr} to ${today}`,\n  summary: {\n    totalPurchases: purchases.length,\n    recentPurchases: purchases.filter(p => p.isRecent).length,\n    totalInventoryValue: purchases.reduce((sum, p) => sum + p.totalCost, 0),\n    totalUnitsPurchased: purchases.reduce((sum, p) => sum + p.quantity, 0),\n    averageUnitCost: purchases.reduce((sum, p) => sum + p.unitCost, 0) / purchases.length\n  },\n  productAnalysis: sortedProducts,\n  reorderRecommendations: sortedProducts.filter(p => p.reorderPriority === 'High'),\n  vendorPerformance: Array.from(\n    purchases.reduce((map, p) => {\n      if (!map.has(p.vendor)) map.set(p.vendor, { vendor: p.vendor, totalSpent: 0, products: new Set() });\n      map.get(p.vendor).totalSpent += p.totalCost;\n      map.get(p.vendor).products.add(p.product);\n      return map;\n    }, new Map())\n  ).map(([vendor, data]) => ({\n    vendor,\n    totalSpent: data.totalSpent,\n    productCount: data.products.size\n  })).sort((a, b) => b.totalSpent - a.totalSpent)\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        320
      ],
      "id": "5aa2c47e-3f44-4e2c-a2aa-b27a6deb13ed",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "content": "Front end Dashboard ",
        "width": 352
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1248,
        -240
      ],
      "id": "814593fd-14d0-4370-9244-e86c7cf74ace",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "order-submit",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "c4095874-12aa-4f4b-b9c8-d8daaf76e579",
      "name": "Webhook1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -6016,
        -16
      ],
      "webhookId": "10b36e11-a832-44b1-a825-21643878eb50"
    },
    {
      "parameters": {
        "jsCode": "// 1ï¸âƒ£ Order items from Webhook\nconst order = $('Webhook1').first().json.body;\nconst orderItems = order.Items || [];\n\n// 2ï¸âƒ£ Inventory rows from Google Sheets (multiple)\nconst inventoryRows = $input.all().map(i => i.json);\n\n// 3ï¸âƒ£ Check each ordered product\nconst checkedProducts = [];\nconst outOfStockProducts = [];\n\nfor (const item of orderItems) {\n  const productId = item.Product_ID;\n  const requiredQty = Number(item.Qty || 0);\n\n  const inventory = inventoryRows.find(\n    row => row.Product_ID === productId\n  );\n\n  const stockQty = Number(\n    String(inventory?.Current_Stock_Qty || 0).trim()\n  );\n\n  const inStock = stockQty >= requiredQty;\n\n  const result = {\n    Product_ID: productId,\n    Product_Name: inventory?.Name || '',\n    requiredQty,\n    stockQty,\n    inStock\n  };\n\n  checkedProducts.push(result);\n\n  if (!inStock) {\n    outOfStockProducts.push(result);\n  }\n}\n\n// 4ï¸âƒ£ Final aggregated output\nreturn [{\n  json: {\n    allStockAvailable: outOfStockProducts.length === 0,\n    checkedProducts,\n    outOfStockProducts\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5104,
        -16
      ],
      "id": "3fd47afc-0816-44dc-bbf9-98692cd6e241",
      "name": "Check Stock Availability"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.allStockAvailable }}",
                    "rightValue": "IN_STOCK",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "8bac4ead-5e0c-42e4-a5b1-957022472836"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "STOCK AVAILABLE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "339011b6-dbe0-4d3f-b92b-8afd5852142d",
                    "leftValue": "={{ $json.allStockAvailable }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "STOCK NOT AVAILABLE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -4864,
        -16
      ],
      "id": "2b71c6c7-b487-4fe9-bae0-9149d2bdf027",
      "name": "Stock Switch"
    },
    {
      "parameters": {
        "jsCode": "const webhookData = $('Webhook1').first().json.body;\nconst customerData = $input.first().json;\nconst items = webhookData.Items || [];\n\nreturn items.map(item => ({\n  json: {\n    Product_ID: item.Product_ID,\n    Qty: item.Qty,\n    Shop_ID: webhookData.Shop_ID,\n    Staff_ID: webhookData.Staff_ID,\n    Total_Amount: webhookData.Total_Amount,\n    Credit_Limit: customerData.Credit_Limit,\n    Current_Balance: customerData.Current_Balance\n  }\n}));"
      },
      "id": "d43303a6-2cde-4f42-9d55-b94036270864",
      "name": "Split Items into Separate Rows1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3920,
        -160
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Product_ID",
              "lookupValue": "={{ $json.Product_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3648,
        -160
      ],
      "id": "5033e360-6ecf-4ce4-92b0-98f21098da69",
      "name": "Get Product Info1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Grab the out-of-stock products from previous node\nconst items = $json.outOfStockProducts || [];\n\nreturn [{\n  json: {\n    status: \"INVENTORY_INSUFFICIENT\",\n    message_english: \"Dear Salesman! Requested quantity is not available.\",\n    message_urdu: \"Ø¹Ø²ÛŒØ² Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†! Ù…Ø·Ù„ÙˆØ¨Û Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’Û”\",\n    outOfStockProducts: items.map(p => ({\n        product_id: p.Product_ID,\n        product_name: p.Product_Name,\n        available_quantity: p.stockQty,\n        requested_quantity: p.requiredQty\n    })),\n    timestamp: new Date().toLocaleString('en-US', { timeZone: 'Asia/Karachi' })\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4640,
        128
      ],
      "id": "c8379bc9-cb5d-4bf5-b4bf-7aeb5b81d396",
      "name": "prepare response for out of stock1"
    },
    {
      "parameters": {
        "jsCode": "// Credit Limit Exceeded Response\nconst webhookData = $('Webhook1').first().json.body;\nconst customerData = $('Get row(s) in sheet8').first().json;\n\nreturn [{\n  json: {\n    status: \"CREDIT_LIMIT_EXCEEDED\",\n    message_english: \"Order cannot be placed due to credit limit exceeded.\",\n    message_urdu: \"Ú©Ø±ÛŒÚˆÙ¹ Ù„ÛŒÙ…Ù¹ Ø³Û’ Ø²ÛŒØ§Ø¯Û ÛÙˆÙ†Û’ Ú©ÛŒ ÙˆØ¬Û Ø³Û’ Ø¢Ø±ÚˆØ± Ù†ÛÛŒÚº Ù„Ú¯Ø§ÛŒØ§ Ø¬Ø§ Ø³Ú©ØªØ§Û”\",\n    current_balance: customerData.Current_Balance || 0,\n    credit_limit: customerData.Credit_Limit || 0,\n    order_amount: webhookData.Total_Amount || 0,\n    timestamp: new Date().toLocaleString('en-US', { timeZone: 'Asia/Karachi' })\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4128,
        80
      ],
      "id": "235e772f-6fd0-4127-9aaf-f7fac05e8665",
      "name": "Credit Limit Exceeded Response"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Shop_ID",
              "lookupValue": "={{ $('Webhook1').first().json.body.Shop_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5792,
        -16
      ],
      "id": "95764635-b38a-4c03-9dfa-174b0ffba8f7",
      "name": "Get row(s) in sheet8",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "da2a03a4-89cd-4f2b-975a-63abb881f18b",
              "leftValue": "={{ Number($('Webhook1').first().json.body.Total_Amount) + Number($('Get row(s) in sheet8').first().json.Current_Balance) }}",
              "rightValue": "={{ $('Get row(s) in sheet8').first().json.Credit_Limit }}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4400,
        -32
      ],
      "id": "8243b0ec-7bfe-41c5-a07a-c8b36aea7f16",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Product_ID": "={{ $json.Product_ID }}",
            "Current_Stock_Qty": "={{ Number($json.Current_Stock_Qty) - Number($('Split Items into Separate Rows1').first().json.Qty) }}"
          },
          "matchingColumns": [
            "Product_ID"
          ],
          "schema": [
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cost_Price",
              "displayName": "Cost_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sale_Price",
              "displayName": "Sale_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Stock_Qty",
              "displayName": "Current_Stock_Qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Unit",
              "displayName": "Unit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3456,
        -16
      ],
      "id": "635f9223-2cc1-4742-9e87-7723d72b7a6d",
      "name": "Update Quantity of Stock1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Current_Balance": "={{ Number($('Collect Product Details1').item.json.Current_Balance) + Number($('Collect Product Details1').item.json.Total_Amount) }}",
            "Last_Visit_Date": "={{ new Date().toISOString().split('T')[0] }}\n",
            "Shop_ID": "={{ $('Collect Product Details1').item.json.Shop_ID }}"
          },
          "matchingColumns": [
            "Shop_ID"
          ],
          "schema": [
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop_Name",
              "displayName": "Shop_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Mobile",
              "displayName": "Owner_Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Area_ID",
              "displayName": "Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Credit_Limit",
              "displayName": "Credit_Limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Balance",
              "displayName": "Current_Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last_Visit_Date",
              "displayName": "Last_Visit_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4736,
        688
      ],
      "id": "f5020ed7-25b2-494d-9f26-9feea9bbca45",
      "name": "Update Customer Available Balance1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "===============================================================\n                     SMART DISTRIBUTION ERP\n==============================================================\n                     Your Trusted Distribution Partner\n==============================================================\n\n                       *** INVOICE DETAILS ***\n--------------------------------------------------------------\nInvoice Number : {{ $('Format Invoice Data1').item.json.Order_ID }}\nInvoice Date   : {{ $('Format Invoice Data1').item.json.Date }}\nTime           : {{ $('Format Invoice Data1').item.json.Time }}\n\n--------------------------------------------------------------\n                       *** CUSTOMER DETAILS ***\n--------------------------------------------------------------\nShop Name      : {{ $('Format Invoice Data1').item.json.Shop_Name }}\nShop ID        : {{ $('Format Invoice Data1').item.json.Shop_ID }}\nArea           : {{ $('Format Invoice Data1').item.json.Area_ID }}\nOwner Name     : {{ $json.Shop_Owner_Name }}\nOwner Mobile   : {{ $('Format Invoice Data1').item.json.Owner_Mobile }}\n\n--------------------------------------------------------------\n                       *** SALES TEAM DETAILS ***\n--------------------------------------------------------------\nSalesman ID    : {{ $('Format Invoice Data1').item.json.Staff_ID }}\nSalesman Name  : {{ $('Format Invoice Data1').item.json.Staff_Name }}\n\n--------------------------------------------------------------\n                       *** PRODUCT DETAILS ***\n--------------------------------------------------------------\nProduct ID | Product Name               | Qty | Unit | Total\n--------------------------------------------------------------\n{{ $('Format Invoice Data1').item.json.Product_Lines }}\n--------------------------------------------------------------\n\n--------------------------------------------------------------\n                       *** ORDER SUMMARY ***\n--------------------------------------------------------------\nTotal Amount   : Rs. {{ $('Format Invoice Data1').item.json.Total_Amount }}\nOrder Status   : {{ $('Format Invoice Data1').item.json.Status }}\nPayment Terms  : CREDIT\n\n--------------------------------------------------------------\n Thank you for choosing SMART DISTRIBUTION.\n We appreciate your business and look forward to serving you again.\n--------------------------------------------------------------\n\nFor Queries & Support:\nPhone  : +92-300-1234567\nEmail  : info@smartdistribution.com\n\n==============================================================\n                 This is a computer-generated invoice\n==============================================================\n",
        "name": "=invoice-{{ $('Format Invoice Data1').item.json.Order_ID }}.txt",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1HfacPE6q0k42FdRFEAvHwubipD1PSpmD",
          "mode": "list",
          "cachedResultName": "Smart Distribution Invoices",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1HfacPE6q0k42FdRFEAvHwubipD1PSpmD"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -3408,
        448
      ],
      "id": "72bc83fb-3425-4263-b1e0-ce6f8a2efb08",
      "name": "Create file from text1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "jkrmqmVXonpl68WJ",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const webhookData = $('Webhook1').first().json.body;\nconst customerData = $input.first().json;\nconst items = webhookData.Items || [];\n\nreturn items.map(item => ({\n  json: {\n    Product_ID: item.Product_ID,\n    Qty: item.Qty,\n    Shop_ID: webhookData.Shop_ID,\n    Staff_ID: webhookData.Staff_ID,\n    Total_Amount: webhookData.Total_Amount,\n    Credit_Limit: customerData.Credit_Limit,\n    Current_Balance: customerData.Current_Balance\n  }\n}));"
      },
      "id": "a26f352a-8796-4a91-bee3-399623517db1",
      "name": "Split Items into Separate Rows2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5536,
        -16
      ]
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst webhookData = $('Webhook1').first().json.body;\nconst customerData = $('Get row(s) in sheet8').first().json;\n\nlet productDetails = '';\nconst orderId = 'ORD-' + Date.now();\nconst orderItems = [];\n\n// Loop items\nfor (const item of allItems) {\n  const productName = item.json.Name || 'Unknown Product';\n  const productId = item.json.Product_ID;\n  const unitPrice = Number(item.json.Sale_Price) || 0;\n\n  const qty = $('Split Items into Separate Rows2')\n    .all()\n    .find(i => i.json.Product_ID === productId)?.json.Qty || 0;\n\n  const totalPrice = Number(qty) * unitPrice;\n\n  productDetails += `${productName} - Qty: ${qty} @ Rs.${unitPrice} = Rs.${totalPrice}\\n`;\n\n  orderItems.push({\n    Order_ID: orderId,\n    Product_ID: productId,\n    Product_Name: productName,\n    Quantity: qty,\n    Unit_Price: unitPrice,\n    Total_Price: totalPrice\n  });\n}\n\n// Return master object\nreturn [{\n  json: {\n    Order_ID: orderId,\n    Shop_ID: webhookData.Shop_ID,\n\n    // FIXED (correct field from webhook)\n    Staff_ID: webhookData.Salesman_ID,\n    Staff_Name: webhookData.Salesman_name,\n\n    Total_Amount: webhookData.Total_Amount,\n    Credit_Limit: customerData.Credit_Limit,\n    Current_Balance: customerData.Current_Balance,\n    Shop_Name: customerData.Shop_Name,\n    Area_ID: customerData.Area_ID,\n    Owner_Mobile: customerData.Owner_Mobile,\n    Last_Visit_Date: customerData.Last_Visit_Date,\n\n    // NEW FIELD â€” Shop Owner\n    Shop_Owner_Name: webhookData.Shop_Owner_Name,\n\n    Product_Details: productDetails,\n    Order_Items: orderItems\n  }\n}];\n"
      },
      "id": "2699e0ea-85e2-4c71-b205-feaa24ca9832",
      "name": "Collect Product Details1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2992,
        -144
      ]
    },
    {
      "parameters": {
        "jsCode": "const orderItems = $json.Order_Items || [];\nconst baseData = {\n  Shop_ID: $json.Shop_ID,\n  Staff_ID: $json.Staff_ID,\n  Total_Amount: $json.Total_Amount,\n  Credit_Limit: $json.Credit_Limit,\n  Current_Balance: $json.Current_Balance,\n  Shop_Name: $json.Shop_Name,\n  Area_ID: $json.Area_ID,\n  Owner_Mobile: $json.Owner_Mobile,\n  Last_Visit_Date: $json.Last_Visit_Date,\n  Product_Details: $json.Product_Details,\n  Order_ID: $json.Order_ID\n};\nreturn orderItems.map(item => ({ json: { ...item, ...baseData } }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2784,
        -144
      ],
      "id": "4976ea57-b714-4c26-ad61-aa86d5eb2f0b",
      "name": "split order items1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "include": "specifiedFields",
        "fieldsToInclude": "Order_ID, Shop_ID, Staff_ID, Total_Amount, Shop_Name, Area_ID, Product_Details, Credit_Limit, Current_Balance, Owner_Mobile, Last_Visit_Date",
        "options": {}
      },
      "id": "d06805dd-cfd8-470d-9681-5ec5ba935454",
      "name": "Aggregate to Single Item1",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -5584,
        688
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "id": "9c367982-d5f4-49ef-ac4a-85094c231e25",
      "name": "Merge Product Data1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3200,
        -144
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "id": "932c9f2f-ff70-47fe-ba5f-d36c539c4e49",
      "name": "Merge Invoice Data1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -4784,
        432
      ]
    },
    {
      "parameters": {
        "jsCode": "// Get all product items from 'Append row in sheet' node\nconst productItems = $('Append row in sheet3').all();\n\n// Get order details from 'Credit Ok' node\nconst orderData = $('credit ok1').first().json;\n\n// Get customer details from 'Collect Product Details' node\nconst customerData = $('Collect Product Details1').first().json;\n\n// Generate Pakistan Time manually (UTC + 5)\nconst now = new Date();\nconst pakistanTime = new Date(now.getTime() + (5 * 60 * 60 * 1000));\n\nconst currentTime = pakistanTime.toLocaleTimeString('en-PK', {\n  hour: '2-digit',\n  minute: '2-digit',\n  second: '2-digit',\n  hour12: true\n});\n\n\n// Format table in readable form\nlet productLines = '';\nlet itemNumber = 1;\n\nfor (const item of productItems) {\n  const productName = item.json.Product_Name || 'Unknown';\n  const productId = item.json.Product_ID || 'N/A';\n  const quantity = item.json.Quantity || 0;\n  const unitPrice = item.json.Unit_Price || 0;\n  const totalPrice = item.json.Total_Price || 0;\n\n  productLines += `${itemNumber}. ${productName} (${productId})\\n`;\n  productLines += `   Qty: ${quantity} | Unit: Rs.${unitPrice} | Total: Rs.${totalPrice}\\n\\n`;\n\n  itemNumber++;\n}\n\nreturn [{\n  json: {\n    Order_ID: orderData.Order_ID,\n    Date: orderData.Date,\n    Time: currentTime,\n    Shop_ID: orderData.Shop_ID,\n    Shop_Name: customerData.Shop_Name,\n    Shop_Owner_Name: customerData.Shop_Owner_Name || 'N/A',\n    Area_ID: customerData.Area_ID,\n    Staff_ID: orderData.Staff_ID,\n    Staff_Name: customerData.Staff_Name || 'Unknown',\n    Total_Amount: orderData.Total_Amount,\n    Status: orderData.Status,\n    Product_Lines: productLines,\n    Owner_Mobile: customerData.Owner_Mobile || 'N/A',\n\n    Credit_Limit: customerData.Credit_Limit || '',\n    New_Balance: $json.Current_Balance || ''\n  }\n}];\n"
      },
      "id": "3c43eaf4-d844-41e1-b04a-b07aa4ebdc37",
      "name": "Format Invoice Data1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3632,
        544
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -3920,
        544
      ],
      "id": "7d1eddb6-4a7d-4d52-a16f-852f546cc4a9",
      "name": "Merge3"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1089928815,
          "mode": "list",
          "cachedResultName": "Sales_Orders_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1089928815"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Order_ID": "={{ $('Collect Product Details1').item.json.Order_ID }}",
            "Date": "={{ new Date().toISOString().split('T')[0] }}",
            "Shop_ID": "={{ $json.Shop_ID }}",
            "Staff_ID": "={{ $('Collect Product Details1').item.json.Staff_ID }}",
            "Total_Amount": "={{ $('Collect Product Details1').item.json.Total_Amount }}",
            "Status": "Pending",
            "Proof_Link": "\"\""
          },
          "matchingColumns": [
            "Shop_ID"
          ],
          "schema": [
            {
              "id": "Order_ID",
              "displayName": "Order_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Staff_ID",
              "displayName": "Staff_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total_Amount",
              "displayName": "Total_Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Proof_Link",
              "displayName": "Proof_Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Remarks",
              "displayName": "Remarks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4512,
        768
      ],
      "id": "e2fab9cf-4573-4f2d-b670-97e1cedac70c",
      "name": "credit ok1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "859277810605199",
        "recipientPhoneNumber": "=923406543866",
        "textBody": "=ðŸš« *CREDIT LIMIT EXCEEDED - ORDER REJECTED* ðŸš«\n\nDear Customer,\n\nYour credit limit has been exceeded, so your order cannot be placed at the moment.\n\n*Current Details:*\nâ€¢ Current Balance: Rs {{ $('Get row(s) in sheet8').first().json.Current_Balance }}\nâ€¢ Credit Limit: Rs {{ $('Get row(s) in sheet8').first().json.Credit_Limit }}\nâ€¢ Order Amount: Rs {{ $('Webhook1').first().json.body.Total_Amount }}\n\nPlease pay your remaining dues so that we can collaborate further. \n\nThank you for your business with us.\n\nðŸ“ž Contact Support: +92-300-1234567\nðŸ¢ Smart Distribution",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        -3904,
        16
      ],
      "id": "31417be5-6478-477b-aaf0-9c13a6d4702f",
      "name": "Send message3",
      "webhookId": "ed89ebaa-5361-4dd2-86cf-64b07111ff0e",
      "credentials": {
        "whatsAppApi": {
          "id": "9uEf6JK6VQ0iYfwT",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "859277810605199",
        "recipientPhoneNumber": "923406543866",
        "textBody": "=ðŸŒŸ *SMART DISTRIBUTION â€“ Order Confirmation* ðŸŒŸ\n\nHello! ðŸ‘‹  \nYour order *{{ $json.Order_ID }}* has been successfully placed on *{{ $json.Date }}* at *{{ $json.Time }}*.\n\nðŸ¬ *Shop Details*  \nâ€¢ *Shop ID:* {{ $json.Shop_ID }}  \nâ€¢ *Shop Name:* {{ $json.Shop_Name }}  \nâ€¢ *Shop Owner:* {{ $json.Shop_Owner_Name }}  \n\nðŸ‘¨â€ðŸ’¼ *Salesman Details*  \nâ€¢ *Salesman ID:* {{ $json.Staff_ID }}  \nâ€¢ *Salesman Name:* {{ $json.Staff_Name }}\n\nðŸ›’ *Products Ordered:*  \n{{ $json.Product_Lines }}\n\nðŸ’° *Total Amount:* Rs {{ $json.Total_Amount }}\n\nðŸšš *Delivery Information*  \nYour order will be delivered on:  \n*{{ new Date(new Date($json.Date).getTime() + 24*60*60*1000).toISOString().split('T')[0] }}*  \nPlease have *Rs {{ $json.Total_Amount }}* ready for cash on delivery.\n\nðŸ™ Thank you for choosing *Smart Distribution*!  \nWe truly appreciate your business and look forward to serving you again.\n\nðŸ“ž For any queries, contact your salesman or our support.\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        -3344,
        640
      ],
      "id": "8b36f46f-e3e4-42e5-8c74-842b09b3edac",
      "name": "Send message4",
      "webhookId": "1e11f462-e808-437d-80b2-04bf66804f39",
      "credentials": {
        "whatsAppApi": {
          "id": "9uEf6JK6VQ0iYfwT",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Product_ID",
              "lookupValue": "={{ $json.Product_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5328,
        -16
      ],
      "id": "4d19c31c-ab82-4854-ab65-eb3132e6040d",
      "name": "Get Product Info2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1862222563,
          "mode": "list",
          "cachedResultName": "Financial_Ledger",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1862222563"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Type": "Credit",
            "Account_Head": "Sales",
            "Amount": "={{ $json.Total_Amount }}",
            "Date": "={{ $json.Date }}",
            "Order-Id": "={{ $json.Order_ID }}",
            "Trans_ID": "={{ $json.Trans_ID }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Trans_ID",
              "displayName": "Trans_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Type",
              "displayName": "Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Account_Head",
              "displayName": "Account_Head",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Amount",
              "displayName": "Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Order-Id",
              "displayName": "Order-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cash_Recieved",
              "displayName": "Cash_Recieved",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rider-Id",
              "displayName": "Rider-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cash_recieved_Date",
              "displayName": "Cash_recieved_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Balance",
              "displayName": "Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3376,
        848
      ],
      "id": "9c52744a-5120-4b00-8b1d-67b140114215",
      "name": "Add Data into Financial Ledger1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1862222563,
          "mode": "list",
          "cachedResultName": "Financial_Ledger",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1862222563"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A:A"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4016,
        768
      ],
      "id": "94d76e37-ea16-4185-bff5-c9da67a22e12",
      "name": "Get Transaction Id from financial ledger1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Generate next Trans_ID\nconst rows = $input.all();\nconst numbers = rows\n    .map(r => r.json.Trans_ID)\n    .filter(id => id)\n    .map(id => parseInt(id.replace(/\\D/g, ''), 10))\n    .filter(num => !isNaN(num));\n\nconst nextNum = numbers.length > 0 ? Math.max(...numbers) + 1 : 1;\nconst transId = \"T\" + nextNum.toString().padStart(3, '0');\n\n// Extract data using the same expressions as your Google Sheets node\ntry {\n    const orderId = $('Collect Product Details1').item.json.Order_ID;\n    const staffId = $('Collect Product Details1').item.json.Staff_ID;\n    const totalAmount = $('Collect Product Details1').item.json.Total_Amount;\n    const shopId = $('Collect Product Details1').first().json.Shop_ID\n    \n    return {\n        json: {\n            Trans_ID: transId,\n            Order_ID: orderId || \"\",\n            Date: new Date().toISOString().split('T')[0],\n            Shop_ID: shopId,\n            Staff_ID: staffId || \"\",\n            Total_Amount: totalAmount || 0,\n            Status: \"Pending\",\n            Proof_Link: \"\\\"\\\"\"\n        }\n    };\n} catch (e) {\n    // Fallback if expressions fail\n    return {\n        json: {\n            Trans_ID: transId,\n            Order_ID: \"\",\n            Date: new Date().toISOString().split('T')[0],\n            Shop_ID: \"\",\n            Staff_ID: \"\",\n            Total_Amount: 0,\n            Status: \"Pending\",\n            Proof_Link: \"\\\"\\\"\"\n        }\n    };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3696,
        768
      ],
      "id": "6f9269f4-7c4c-4e1c-8970-0144eae06f88",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1691280817,
          "mode": "list",
          "cachedResultName": "Order_Items",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1691280817"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Order_ID": "={{ $json.Order_ID }}",
            "Product_ID": "={{ $json.Product_ID }}",
            "Product_Name": "={{ $json.Product_Name }}",
            "Quantity": "={{ $json.Quantity }}",
            "Unit_Price": "={{ $json.Unit_Price }}",
            "Total_Price": "={{ $json.Total_Price }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Order_ID",
              "displayName": "Order_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Product_Name",
              "displayName": "Product_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Quantity",
              "displayName": "Quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Unit_Price",
              "displayName": "Unit_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total_Price",
              "displayName": "Total_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2816,
        176
      ],
      "id": "c0871ee0-89ae-4aca-8fa2-0dd5e2757cc3",
      "name": "Append row in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "Order Booking workflow",
        "height": 80,
        "width": 208
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5920,
        -144
      ],
      "id": "8a2a0dce-bb19-480a-bd56-2f8070eb5f46",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -4416,
        128
      ],
      "id": "321e4fa9-594d-496b-9156-1e660bd5ca16",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3904,
        176
      ],
      "id": "82604221-8e61-439d-a8ce-ee4d8361595c",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -2848,
        640
      ],
      "id": "b78b6a46-23eb-4952-a77f-af2c70c0e9b5",
      "name": "Respond to Webhook6"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Dilivery-status",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -5984,
        1472
      ],
      "id": "06eb8550-7ed4-4ff3-9195-daebd6a5e388",
      "name": "App Trigger Webhook",
      "webhookId": "ae9ed48d-2505-4ef5-8432-ba524b3e3199"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a6b464d-0afa-4d6f-824b-4863821b5776",
              "leftValue": "={{ $json.body.cash_received }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -5776,
        1632
      ],
      "id": "cac7e9b4-d752-403c-b43a-b1eb5e690d23",
      "name": "Check Cash Received"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1862222563,
          "mode": "list",
          "cachedResultName": "Financial_Ledger",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1862222563"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Order-Id": "={{ $json.body.order_id }}",
            "Cash_Recieved": "={{ $json.body.cash_received }}",
            "Cash_recieved_Date": "={{ $today.toFormat('yyyy-MM-dd') }}",
            "Rider-Id": "={{ $json.body.rider_id }}"
          },
          "matchingColumns": [
            "Order-Id"
          ],
          "schema": [
            {
              "id": "Trans_ID",
              "displayName": "Trans_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Type",
              "displayName": "Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Account_Head",
              "displayName": "Account_Head",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Amount",
              "displayName": "Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Order-Id",
              "displayName": "Order-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Cash_Recieved",
              "displayName": "Cash_Recieved",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Rider-Id",
              "displayName": "Rider-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Cash_recieved_Date",
              "displayName": "Cash_recieved_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Balance",
              "displayName": "Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5392,
        1632
      ],
      "id": "877de674-f98c-4213-8ed1-b358aba61de5",
      "name": "Update Financial Ledger",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a068f3d1-f9fe-438a-bc9b-cdb1e7f46ccf",
              "leftValue": "={{ $json.body.return_items.length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -5328,
        1472
      ],
      "id": "32f2c3dc-4ca5-4cf0-ad95-733aae27ad44",
      "name": "Check Return Items"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1015408272,
          "mode": "list",
          "cachedResultName": "Returns_Breakage",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1015408272"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "Return_ID": "={{ $json.Return_ID }}",
            "Return_Date": "={{ $today.toFormat('yyyy-MM-dd') }}",
            "Order_Ref": "={{ $('Code in JavaScript8').item.json.Order_Ref }}",
            "Qty": "={{ $('Code in JavaScript8').item.json.Qty }}",
            "Reason": "={{ $('Code in JavaScript8').item.json.Reason }}",
            "Action": "={{ $('Code in JavaScript8').item.json.Action }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Return_ID",
              "displayName": "Return_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Return_Date",
              "displayName": "Return_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Order_Ref",
              "displayName": "Order_Ref",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Qty",
              "displayName": "Qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Reason",
              "displayName": "Reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Cash_Received",
              "displayName": "Cash_Received",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Rider_ID",
              "displayName": "Rider_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Rider_Name",
              "displayName": "Rider_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4544,
        1456
      ],
      "id": "38f84d4b-2a11-4eb6-abd7-0a56c848615b",
      "name": "Log Returns Breakage",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5fa55056-637c-4266-b0c2-6ac4d2c2f31e",
              "leftValue": "={{$json.Action}}",
              "rightValue": "Restock",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4320,
        1456
      ],
      "id": "55eb82f9-30b3-41e6-b3c9-0ff3d3a82d22",
      "name": "Check If Restock"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Product_ID": "={{ $json.Product_ID }}",
            "Current_Stock_Qty": "={{ (Number($json.Current_Stock_Qty) || 0) + (Number($node[\"Check If Restock\"].json.Qty) || 0) }}"
          },
          "matchingColumns": [
            "Product_ID"
          ],
          "schema": [
            {
              "id": "Product_ID",
              "displayName": "Product_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_Name",
              "displayName": "Vendor_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cost_Price",
              "displayName": "Cost_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sale_Price",
              "displayName": "Sale_Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Stock_Qty",
              "displayName": "Current_Stock_Qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Unit",
              "displayName": "Unit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_Name",
              "displayName": "Vendor_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "headers",
              "displayName": "headers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "params",
              "displayName": "params",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "webhookUrl",
              "displayName": "webhookUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "executionMode",
              "displayName": "executionMode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3840,
        1440
      ],
      "id": "80a748ba-1a5c-4e6a-ae2b-cc5d69686cb2",
      "name": "Update Product Inventory",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Product_ID",
              "lookupValue": "={{ $json.Product_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4064,
        1440
      ],
      "id": "3354728a-31fe-445f-a164-7e1dcec78d8c",
      "name": "Get Current Stock1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1089928815,
          "mode": "list",
          "cachedResultName": "Sales_Orders_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1089928815"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Order_ID": "={{ $json.body.order_id }}",
            "Status": "=Confirmed",
            "Remarks": "={{ $json.body.status }}"
          },
          "matchingColumns": [
            "Order_ID"
          ],
          "schema": [
            {
              "id": "Order_ID",
              "displayName": "Order_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Staff_ID",
              "displayName": "Staff_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total_Amount",
              "displayName": "Total_Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Proof_Link",
              "displayName": "Proof_Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Remarks",
              "displayName": "Remarks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5472,
        1872
      ],
      "id": "a768f356-0f63-4cc7-8ed5-73b827102ab2",
      "name": "Change status in the sales order log",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Webhook payload structure:\n// items[0].json.body.return_items[]\n\nconst body = $json.body || {};\nconst returnItems = body.return_items || [];\n\nreturn returnItems.map((item, index) => ({\n  json: {\n    // Meta\n    Return_ID: `RET-${Date.now()}-${index + 1}`,\n    Return_Date: new Date().toISOString().split('T')[0],\n\n    // Order context\n    Order_Ref: body.order_id,\n    Shop_ID: body.shop_id,\n    Status: body.status,\n    Cash_Received: body.cash_received,\n\n    // Rider\n    Rider_ID: body.rider_id || '',\n    Rider_Name: body.rider_name || '',\n\n    // Product return\n    Product_ID: item.product_id,\n    Qty: Number(item.qty) || 0,\n    Reason: item.reason || '',\n    Action: item.action || ''\n  }\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4960,
        1456
      ],
      "id": "8aaf4beb-54bb-463b-bde8-bd967f00da69",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "content": "Delivery System",
        "width": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6320,
        1696
      ],
      "id": "5c081daa-c848-4225-b39b-41fad9eb8f0e",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Shop_ID",
              "lookupValue": "={{ $('Check Cash Received').item.json.body.shop_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5136,
        1632
      ],
      "id": "adc345ec-3737-4124-8499-add558a361e0",
      "name": "Get customer data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Shop_ID": "={{ $json.Shop_ID }}",
            "Current_Balance": "={{Number($json.Current_Balance)-Number( $('Update Financial Ledger').item.json.Cash_Recieved )}}"
          },
          "matchingColumns": [
            "Shop_ID"
          ],
          "schema": [
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop_Name",
              "displayName": "Shop_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Mobile",
              "displayName": "Owner_Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Name",
              "displayName": "Owner_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Area_ID",
              "displayName": "Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Credit_Limit",
              "displayName": "Credit_Limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Balance",
              "displayName": "Current_Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last_Visit_Date",
              "displayName": "Last_Visit_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4896,
        1632
      ],
      "id": "12e2ea20-49e8-42db-8c89-584c4727a173",
      "name": "update customer balance",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Shop_ID",
              "lookupValue": "={{ $json.Shop_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3680,
        1248
      ],
      "id": "fa4e988e-ce37-494b-8511-968e9d7669a3",
      "name": "Get customer data1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Shop_ID": "={{ $json.Shop_ID }}",
            "Current_Balance": "={{ Number($json.Current_Balance) - Number($('Aggregate Total Return').item.json.Total_Return_Amount) }}\n"
          },
          "matchingColumns": [
            "Shop_ID"
          ],
          "schema": [
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop_Name",
              "displayName": "Shop_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Mobile",
              "displayName": "Owner_Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Name",
              "displayName": "Owner_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Area_ID",
              "displayName": "Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Credit_Limit",
              "displayName": "Credit_Limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Balance",
              "displayName": "Current_Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last_Visit_Date",
              "displayName": "Last_Visit_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3440,
        1248
      ],
      "id": "6e978b53-b4c3-433b-8dbe-fefe851faa34",
      "name": "update customer balance1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1751467871,
          "mode": "list",
          "cachedResultName": "Product_Inventory",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=1751467871"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Product_ID",
              "lookupValue": "={{ $json.Product_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4736,
        1248
      ],
      "id": "ddf89ac5-4f15-4658-8f67-bdd5b133b572",
      "name": "Get products sale price",
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -4384,
        1248
      ],
      "id": "ca22fbba-2b06-4844-b714-5c30ce4a35d7",
      "name": "Merge2"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const qty = Number(item.json.Qty || 0);\n  const salePrice = Number(item.json.Sale_Price || 0);\n\n  return {\n    json: {\n      ...item.json,\n      Return_Amount: qty * salePrice\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4128,
        1248
      ],
      "id": "57d10200-6a7b-4250-bda7-9380726d5761",
      "name": "Calculate Return Amount"
    },
    {
      "parameters": {
        "jsCode": "let totalReturn = 0;\nlet shopId = null;\nlet orderRef = null;\n\nfor (const item of items) {\n  totalReturn += Number(item.json.Return_Amount || 0);\n\n  // capture shared metadata once\n  if (!shopId) shopId = item.json.Shop_ID;\n  if (!orderRef) orderRef = item.json.Order_Ref;\n}\n\nreturn [\n  {\n    json: {\n      Shop_ID: shopId,\n      Order_Ref: orderRef,\n      Total_Return_Amount: totalReturn\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3920,
        1248
      ],
      "id": "53277cee-4591-49d6-a49d-4e4e20627eac",
      "name": "Aggregate Total Return"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "859277810605199",
        "recipientPhoneNumber": "923406543866",
        "textBody": "=Dear customer, your order {{ $('App Trigger Webhook').item.json.body.order_id }} has been delivered successfully by the Deliery Man : {{ $('App Trigger Webhook').first().json.body.rider_name }}\nYour have paid Total amount = {{ $('App Trigger Webhook').first().json.body.cash_received }} RS to the Rider .\nYour balance which you have to pay to the company is : {{ $json.Current_Balance }}\nThank you for your business with us ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        -4576,
        1632
      ],
      "id": "a2022225-4c61-4f07-a48b-bd4ea2b93bf0",
      "name": "Send message2",
      "webhookId": "668dc358-bb45-49a7-b673-3d63e5dd8c30",
      "credentials": {
        "whatsAppApi": {
          "id": "9uEf6JK6VQ0iYfwT",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2052506336,
          "mode": "list",
          "cachedResultName": "Dilivery-History",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2052506336"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date": "={{ new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Karachi' }) }}",
            "Order-Id": "={{ $json.body.order_id }}",
            "Shop_Id": "={{ $json.body.shop_id }}",
            "Rider-Id": "={{ $json.body.rider_id }}",
            "Rider_Name": "={{ $json.body.rider_name }}",
            "Order_status": "={{ $json.body.status }}",
            "Cash-Recieved": "={{ $json.body.cash_received }}",
            "Time": "={{ new Date().toLocaleTimeString('en-US', { timeZone: 'Asia/Karachi', hour12: true, hour: '2-digit', minute: '2-digit' }) }}",
            "Return_Items": "={{ $json.body.return_items }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Time",
              "displayName": "Time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Order-Id",
              "displayName": "Order-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Shop_Id",
              "displayName": "Shop_Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rider-Id",
              "displayName": "Rider-Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rider_Name",
              "displayName": "Rider_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cash-Recieved",
              "displayName": "Cash-Recieved",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Order_status",
              "displayName": "Order_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Return_Items",
              "displayName": "Return_Items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5728,
        1344
      ],
      "id": "f2a7b3de-e19c-4dce-afdb-694a9d42afc3",
      "name": "Append row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "13b09b8c-6d41-4928-86ae-ffce7a16b7a5",
              "leftValue": "={{ $json.body.New_Vendor_Data }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        784,
        528
      ],
      "id": "9ab6a897-c903-4eca-94ad-c3d965492992",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 329416617,
          "mode": "list",
          "cachedResultName": "Vendors_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=329416617"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Vendor_ID": "={{ $json.body.New_Vendor_Data.Vendor_ID }}",
            "Vendor_Name": "={{ $json.body.New_Vendor_Data.Vendor_Name }}",
            "Contact": "={{ $json.body.New_Vendor_Data.Contact }}",
            "Category": "={{ $json.body.New_Vendor_Data.Category }}",
            "City": "={{ $json.body.New_Vendor_Data.City }}",
            "Status": "={{ $json.body.New_Vendor_Data.Status }}",
            "Payment_Terms": "30 Days"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Vendor_ID",
              "displayName": "Vendor_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor_Name",
              "displayName": "Vendor_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Contact",
              "displayName": "Contact",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Category",
              "displayName": "Category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "City",
              "displayName": "City",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Payment_Terms",
              "displayName": "Payment_Terms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1280,
        512
      ],
      "id": "8626cfec-7db9-46be-9893-354f09585ea3",
      "name": "Add data into vender DB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Add-customer",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        560,
        720
      ],
      "id": "fe3f3d91-8fc6-4a98-8842-5c025f61f7ff",
      "name": "Add Customer",
      "webhookId": "3598b32e-6be9-4e9f-b962-69cfe96febbd"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 180494532,
          "mode": "list",
          "cachedResultName": "Customers_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=180494532"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Shop_ID": "={{ $json.body.Shop_ID }}",
            "Shop_Name": "={{ $json.body.Shop_Name }}",
            "Owner_Mobile": "={{ $json.body.Owner_Mobile }}",
            "Owner_Name": "={{ $json.body.Owner_Name }}",
            "Area_ID": "={{ $json.body.Area_ID }}",
            "Credit_Limit": "={{ $json.body.Credit_Limit }}",
            "Current_Balance": "={{ $json.body.Current_Balance }}",
            "Last_Visit_Date": "={{ $json.body.Last_Visit_Date }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Shop_ID",
              "displayName": "Shop_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Shop_Name",
              "displayName": "Shop_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Mobile",
              "displayName": "Owner_Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Owner_Name",
              "displayName": "Owner_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Area_ID",
              "displayName": "Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Credit_Limit",
              "displayName": "Credit_Limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Current_Balance",
              "displayName": "Current_Balance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last_Visit_Date",
              "displayName": "Last_Visit_Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        800,
        720
      ],
      "id": "0d166e34-63a4-475c-b133-579af6a13f0e",
      "name": "Add customer data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1008,
        720
      ],
      "id": "ddc7329e-a29a-40a4-a1f9-8ea40e459fa1",
      "name": "Resond to the customer"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "change-status",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -992,
        1152
      ],
      "id": "a7e1cfbe-1681-486d-a6ef-9f0677e878e9",
      "name": "Change staff status",
      "webhookId": "db508965-ff72-4426-aa74-a2aaa459731b"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Staff_ID": "={{ $json.body.id }}",
            "Account_Status": "={{ $json.body.status }}"
          },
          "matchingColumns": [
            "Staff_ID"
          ],
          "schema": [
            {
              "id": "Staff_ID",
              "displayName": "Staff_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Role",
              "displayName": "Role",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Mobile",
              "displayName": "Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_ID",
              "displayName": "Assigned_Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_Name",
              "displayName": "Assigned_Area_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Base_Salary",
              "displayName": "Base_Salary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Username",
              "displayName": "Username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Password_Hash",
              "displayName": "Password_Hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Account_Status",
              "displayName": "Account_Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -736,
        1152
      ],
      "id": "1556f6f8-e98e-4531-bba1-687ab6727c2e",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "delet-staff",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        544,
        928
      ],
      "id": "50bb9776-f256-46bb-b170-62616942cf19",
      "name": "Delete staff",
      "webhookId": "6cf2a573-4590-4195-afe1-a8c160172945"
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "startIndex": "={{ $json.startRow }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1408,
        928
      ],
      "id": "d538d73c-d278-4122-99ae-344d997836a1",
      "name": "Delete rows or columns from sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -528,
        1152
      ],
      "id": "eb63b80a-ac2d-4366-a542-a14fde2cfec2",
      "name": "Respond to status of employee"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRangeA1",
              "range": "A:A"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        976,
        928
      ],
      "id": "19a378bc-d95c-48cc-a3d0-402cffe3edcf",
      "name": "Get Staff row no",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Read staffId from the Set node (executed upstream)\nconst staffIdRaw = $items(\"Get staff id\")[0].json.staffId;\n\nif (!staffIdRaw) {\n  throw new Error(\"Staff_ID is missing from Set node\");\n}\n\nconst staffId = staffIdRaw.trim().toLowerCase();\n\n// Loop through Google Sheets rows (current node input)\nfor (const item of items) {\n  const sheetStaffId = String(item.json.Staff_ID || \"\")\n    .trim()\n    .toLowerCase();\n\n  if (sheetStaffId === staffId) {\n    return [{\n      json: {\n        startRow: item.json.row_number,\n        rowsToDelete: 1,\n        matchedStaffId: item.json.Staff_ID\n      }\n    }];\n  }\n}\n\nthrow new Error(`Staff_ID ${staffId} not found in sheet`);\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        928
      ],
      "id": "e446366e-ab57-4abb-a2b9-2249241744ac",
      "name": "find row no of staff"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0934a257-4b67-4b28-9fde-181f9cd87863",
              "name": "staffId",
              "value": "={{ $json.body.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        768,
        928
      ],
      "id": "78642557-3c05-4fe4-8744-ed1a7391c4e7",
      "name": "Get staff id"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1616,
        928
      ],
      "id": "91fd819f-8c6f-4d8e-b6f7-bcdba1704285",
      "name": "Respond to delete staff"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -544,
        960
      ],
      "id": "72bb0c0a-d7c9-46ae-87ad-3765c8d7d80d",
      "name": "Respond to add employee"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "reset-password",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        528,
        1232
      ],
      "id": "88dbdee4-21cf-4579-bc6f-a9ecacf7288d",
      "name": "password reset",
      "webhookId": "5584727d-4a9d-4765-a4ac-efd7ad70119a"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Staff_ID",
              "lookupValue": "={{ $json.body.Staff_ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        736,
        1232
      ],
      "id": "ae5aa290-db79-4705-bc79-750ed5026687",
      "name": "Get Staff Id for password reset",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bc32c62b-0bbf-481d-9cb0-c53377a75a35",
              "leftValue": "={{ $('password reset').first().json.body.Staff_ID }}",
              "rightValue": "={{ $json.Staff_ID }}",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "0cd4029a-fcf4-4b12-83a2-e0e2aec7eae6",
              "leftValue": "={{ $('password reset').first().json.body.Name }}",
              "rightValue": "={{ $json.Name }}",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        944,
        1232
      ],
      "id": "1d13f209-9d57-447a-ab93-ac45943f0717",
      "name": "If3"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64",
          "mode": "list",
          "cachedResultName": "Smart Distribution Updated",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084608130,
          "mode": "list",
          "cachedResultName": "Staff_Master",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13_YK0Pk5wVyE1c6gTlbvz4poAE0XTCbVPioiLza3u64/edit#gid=2084608130"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Staff_ID": "={{ $json.Staff_ID }}",
            "Password_Hash": "={{ $('password reset').first().json.body.Password_Hash }}",
            "Last-password-reset-date": "={{ DateTime.now().setZone('Asia/Karachi').toFormat('dd-MM-yyyy hh:mm a') }}"
          },
          "matchingColumns": [
            "Staff_ID"
          ],
          "schema": [
            {
              "id": "Staff_ID",
              "displayName": "Staff_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Role",
              "displayName": "Role",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Mobile",
              "displayName": "Mobile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_ID",
              "displayName": "Assigned_Area_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Assigned_Area_Name",
              "displayName": "Assigned_Area_Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Base_Salary",
              "displayName": "Base_Salary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Username",
              "displayName": "Username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Password_Hash",
              "displayName": "Password_Hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Account_Status",
              "displayName": "Account_Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last-password-reset-date",
              "displayName": "Last-password-reset-date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1264,
        1216
      ],
      "id": "40c9ca49-7d71-4320-b4a5-ab7f60bb4659",
      "name": "password change",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yZPLO4FCzzGgIWKD",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1472,
        1216
      ],
      "id": "10971b14-4f94-410e-91d9-0ad50274f730",
      "name": "repond to password"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1152,
        1328
      ],
      "id": "9021de2b-ee78-4607-9baa-6bccce2cbc97",
      "name": "respond to password"
    }
  ],
  "pinData": {},
  "connections": {
    "Add Product into inventry": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Purchase Id",
            "type": "main",
            "index": 0
          },
          {
            "node": "Add Product Inventry",
            "type": "main",
            "index": 0
          },
          {
            "node": "Add Vender Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Purchase Id": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Add Purchase Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Purchase Id": {
      "main": [
        [
          {
            "node": "Generate Purchase Id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Purchase Log": {
      "main": [
        []
      ]
    },
    "Add Employee": {
      "main": [
        [
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Monthly Summary": {
      "main": [
        [
          {
            "node": "Get Staff Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Vender Summary": {
      "main": [
        [
          {
            "node": "Get Monthly Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Daily Summary": {
      "main": [
        [
          {
            "node": "Get Vender Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Staff Summary": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Area Summary": {
      "main": [
        [
          {
            "node": "Get Daily Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Order request": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dashboard data": {
      "main": [
        [
          {
            "node": "Get Area Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Customer Detail": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Extract Previous 7 Days customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract data": {
      "main": [
        [
          {
            "node": "Respond order",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Previous 7 Days customer": {
      "main": [
        [
          {
            "node": "Respond customer data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Purchase Request": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "filter staff with more than 5 order",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "filter staff with more than 5 order": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Sales Data": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Product Id": {
      "main": [
        [
          {
            "node": "Get Product ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Product ID": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Sales Man Data By Id": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet4": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Respond with staff Id sales data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Order-details By id": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet5": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Respond Order detail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet6": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Delivery for admin": {
      "main": [
        [
          {
            "node": "Get All Delivery",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Delivery": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Respond to dilivery for admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Delivery History": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet7": {
      "main": [
        [
          {
            "node": "Extract data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Respond purchase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Stock Availability": {
      "main": [
        [
          {
            "node": "Stock Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Stock Switch": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "prepare response for out of stock1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Items into Separate Rows1": {
      "main": [
        [
          {
            "node": "Get Product Info1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Product Info1": {
      "main": [
        [
          {
            "node": "Update Quantity of Stock1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Product Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare response for out of stock1": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Credit Limit Exceeded Response": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet8": {
      "main": [
        [
          {
            "node": "Split Items into Separate Rows2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Split Items into Separate Rows1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Credit Limit Exceeded Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Quantity of Stock1": {
      "main": [
        [
          {
            "node": "Merge Product Data1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Update Customer Available Balance1": {
      "main": [
        [
          {
            "node": "credit ok1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Create file from text1": {
      "main": [
        [
          {
            "node": "Respond to Webhook6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Items into Separate Rows2": {
      "main": [
        [
          {
            "node": "Get Product Info2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Collect Product Details1": {
      "main": [
        [
          {
            "node": "split order items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "split order items1": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate to Single Item1": {
      "main": [
        [
          {
            "node": "Update Customer Available Balance1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Product Data1": {
      "main": [
        [
          {
            "node": "Collect Product Details1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Invoice Data1": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Invoice Data1": {
      "main": [
        [
          {
            "node": "Create file from text1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Format Invoice Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "credit ok1": {
      "main": [
        [
          {
            "node": "Merge Invoice Data1",
            "type": "main",
            "index": 1
          },
          {
            "node": "Get Transaction Id from financial ledger1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message4": {
      "main": [
        [
          {
            "node": "Respond to Webhook6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Product Info2": {
      "main": [
        [
          {
            "node": "Check Stock Availability",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Data into Financial Ledger1": {
      "main": [
        [
          {
            "node": "Respond to Webhook6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Transaction Id from financial ledger1": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Add Data into Financial Ledger1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet3": {
      "main": [
        [
          {
            "node": "Aggregate to Single Item1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Invoice Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "App Trigger Webhook": {
      "main": [
        [
          {
            "node": "Check Return Items",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Cash Received",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Cash Received": {
      "main": [
        [
          {
            "node": "Update Financial Ledger",
            "type": "main",
            "index": 0
          },
          {
            "node": "Change status in the sales order log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Financial Ledger": {
      "main": [
        [
          {
            "node": "Get customer data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Return Items": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Returns Breakage": {
      "main": [
        [
          {
            "node": "Check If Restock",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If Restock": {
      "main": [
        [
          {
            "node": "Get Current Stock1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Current Stock1": {
      "main": [
        [
          {
            "node": "Update Product Inventory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Log Returns Breakage",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get products sale price",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get customer data": {
      "main": [
        [
          {
            "node": "update customer balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update customer balance": {
      "main": [
        [
          {
            "node": "Send message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get customer data1": {
      "main": [
        [
          {
            "node": "update customer balance1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get products sale price": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Calculate Return Amount",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Return Amount": {
      "main": [
        [
          {
            "node": "Aggregate Total Return",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Total Return": {
      "main": [
        [
          {
            "node": "Get customer data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Add data into vender DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Customer": {
      "main": [
        [
          {
            "node": "Add customer data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add customer data": {
      "main": [
        [
          {
            "node": "Resond to the customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change staff status": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete staff": {
      "main": [
        [
          {
            "node": "Get staff id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Respond to status of employee",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Staff row no": {
      "main": [
        [
          {
            "node": "find row no of staff",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "find row no of staff": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get staff id": {
      "main": [
        [
          {
            "node": "Get Staff row no",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet": {
      "main": [
        [
          {
            "node": "Respond to delete staff",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Respond to add employee",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "password reset": {
      "main": [
        [
          {
            "node": "Get Staff Id for password reset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Staff Id for password reset": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "password change",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "respond to password",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "password change": {
      "main": [
        [
          {
            "node": "repond to password",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7f0c7eda-f174-4890-9d13-2162b7191db6",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e498c42bc55230ae4115a7f01e084e60f09c838aab5ea01999350c2a67117d2e"
  },
  "id": "zuUIJNeaRyNCt878",
  "tags": []
}